{"version":3,"sources":["socket.js","reducer.js","components/JoinBlock.jsx","components/Chat.jsx","App.js","index.js"],"names":["socket","io","state","action","type","joined","userName","payload","roomId","users","messages","JoinBlock","onLogin","React","useState","setRoomId","setUserName","isLoading","setLoading","onEnter","a","alert","obj","axios","post","className","placeholder","value","onChange","e","target","disabled","onClick","Chat","onAddMessage","messageValue","setMessageValue","messagesRef","useRef","useEffect","current","scrollTo","length","map","name","index","key","ref","message","text","rows","emit","App","useReducer","reducer","dispatch","get","data","setUsers","addMessage","on","window","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.8ee1cda0.chunk.js","sourcesContent":["import io from 'socket.io-client';\n\nconst socket = io();\n\nexport default socket;\n","export default (state, action) => {\n  switch (action.type) {\n    case 'JOINED':\n      return {\n        ...state,\n        joined: true,\n        userName: action.payload.userName,\n        roomId: action.payload.roomId,\n      };\n\n    case 'SET_DATA':\n      return {\n        ...state,\n        users: action.payload.users,\n        messages: action.payload.messages,\n      };\n\n    case 'SET_USERS':\n      return {\n        ...state,\n        users: action.payload,\n      };\n\n    case 'NEW_MESSAGE':\n      return {\n        ...state,\n        messages: [...state.messages, action.payload],\n      };\n\n    default:\n      return state;\n  }\n};\n","import React from 'react';\nimport axios from 'axios';\n\nfunction JoinBlock({ onLogin }) {\n  const [roomId, setRoomId] = React.useState('');\n  const [userName, setUserName] = React.useState('');\n  const [isLoading, setLoading] = React.useState(false);\n\n  const onEnter = async () => {\n    if (!roomId || !userName) {\n      return alert('Неверные данные');\n    }\n    const obj = {\n      roomId,\n      userName,\n    };\n    setLoading(true);\n    await axios.post('/rooms', obj);\n    onLogin(obj);\n  };\n\n  return (\n    <div className=\"join-block\">\n      <input\n        type=\"text\"\n        placeholder=\"Room ID\"\n        value={roomId}\n        onChange={(e) => setRoomId(e.target.value)}\n      />\n      <input\n        type=\"text\"\n        placeholder=\"Ваше имя\"\n        value={userName}\n        onChange={(e) => setUserName(e.target.value)}\n      />\n      <button disabled={isLoading} onClick={onEnter} className=\"btn btn-success\">\n        {isLoading ? 'ВХОД...' : 'ВОЙТИ'}\n      </button>\n    </div>\n  );\n}\n\nexport default JoinBlock;\n","import React from 'react';\nimport socket from '../socket';\n\nfunction Chat({ users, messages, userName, roomId, onAddMessage }) {\n  const [messageValue, setMessageValue] = React.useState('');\n  const messagesRef = React.useRef(null);\n\n  const onSendMessage = () => {\n    socket.emit('ROOM:NEW_MESSAGE', {\n      userName,\n      roomId,\n      text: messageValue,\n    });\n    onAddMessage({ userName, text: messageValue });\n    setMessageValue('');\n  };\n\n  React.useEffect(() => {\n    messagesRef.current.scrollTo(0, 99999);\n  }, [messages]);\n\n  return (\n    <div className=\"chat\">\n      <div className=\"chat-users\">\n        Комната: <b>{roomId}</b>\n        <hr />\n        <b>Онлайн ({users.length}):</b>\n        <ul>\n          {users.map((name, index) => (\n            <li key={name + index}>{name}</li>\n          ))}\n        </ul>\n      </div>\n      <div className=\"chat-messages\">\n        <div ref={messagesRef} className=\"messages\">\n          {messages.map((message) => (\n            <div className=\"message\">\n              <p>{message.text}</p>\n              <div>\n                <span>{message.userName}</span>\n              </div>\n            </div>\n          ))}\n        </div>\n        <form>\n          <textarea\n            value={messageValue}\n            onChange={(e) => setMessageValue(e.target.value)}\n            className=\"form-control\"\n            rows=\"3\"></textarea>\n          <button onClick={onSendMessage} type=\"button\" className=\"btn btn-primary\">\n            Отправить\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n}\n\nexport default Chat;\n","import React from 'react';\nimport axios from 'axios';\n\nimport socket from './socket';\n\nimport reducer from './reducer';\nimport JoinBlock from './components/JoinBlock';\nimport Chat from './components/Chat';\n\nfunction App() {\n  const [state, dispatch] = React.useReducer(reducer, {\n    joined: false,\n    roomId: null,\n    userName: null,\n    users: [],\n    messages: [],\n  });\n\n  const onLogin = async (obj) => {\n    dispatch({\n      type: 'JOINED',\n      payload: obj,\n    });\n    socket.emit('ROOM:JOIN', obj);\n    const { data } = await axios.get(`/rooms/${obj.roomId}`);\n    dispatch({\n      type: 'SET_DATA',\n      payload: data,\n    });\n  };\n\n  const setUsers = (users) => {\n    dispatch({\n      type: 'SET_USERS',\n      payload: users,\n    });\n  };\n\n  const addMessage = (message) => {\n    dispatch({\n      type: 'NEW_MESSAGE',\n      payload: message,\n    });\n  };\n\n  React.useEffect(() => {\n    socket.on('ROOM:SET_USERS', setUsers);\n    socket.on('ROOM:NEW_MESSAGE', addMessage);\n  }, []);\n\n  window.socket = socket;\n\n  return (\n    <div className=\"wrapper\">\n      {!state.joined ? (\n        <JoinBlock onLogin={onLogin} />\n      ) : (\n        <Chat {...state} onAddMessage={addMessage} />\n      )}\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n);\n"],"sourceRoot":""}